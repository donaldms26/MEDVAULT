<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1, width=device-width" />
  <link rel="stylesheet" href="./global.css" />
  <link rel="stylesheet" href="./appointment.css" />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;0,700;1,700&display=swap"
  />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Noto Sans:wght@400;700&display=swap"
  />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;700&display=swap"
  />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
  />
  <style>
    .nav-button {
      display: inline-block;
      margin: 10px;
      padding: 10px 20px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      font-size: 16px;
      transition: background-color 0.3s, color 0.3s;
    }

    .nav-button:hover {
      background-color: #0056b3;
      color: #e2e6ea;
    }

    .nav-button a {
      color: inherit;
      text-decoration: none;
    }

    .error {
      color: red;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="make-an-appointment">
    <div class="container-108">
      <img class="image-74-icon" alt="" src="./public/image-74@2x.png" />
      <div class="oval-36"></div>
    </div>
    <img class="container-109-icon" alt="" src="./public/container-109@2x.png" />
    <img class="container-110-icon" alt="" src="./public/container-110@2x.png" />
    <div class="oval-38"></div>
    <div class="button-48">
      <div class="make-an-appointment1">Make an appointment</div>
    </div>
    <section class="overlay-2"></section>
    <header class="frame-container">
      <div class="container-111">
        <div class="frame3"></div>
        <div class="container-frame">
          <div class="med-vault-text">
            <h3 class="medvault2">MedVault</h3>
            <img
              class="image-2-icon2"
              loading="lazy"
              alt=""
              src="https://d1xzdqg8s8ggsr.cloudfront.net/65f06e668a5b58e062cf65c5/372a10f4-c0bc-48a9-910e-8f1269cc0f90_1710256370339773749?Expires=-62135596800&Signature=l3IDeIvpsrvGtRkFrTQ31hCXVduNba-xC7oh5juJjJmVNQ4VRmYe8A~Wt1YuncSGk5qx7w0e4yyqpe~2-633eguAOOj5q4m8ENSTL1c-Mb9uSMRwMtYyeNLYixDr0AXhGlNTpSf8yv7Z5cdwkSUHzSC4LsLEcJzekChYrmkMsiTexQdiEGgzfk4xcRkzKXK09y9tzuxRLgntE3qbUVjl6ba2GCCgbCzX1dHEyengXlua7qVczcu6BT4g4ITbP6ioFkJl4BsWf5yUHU-QUTJkMEgKBqRuL3g02ebberdqgynCgUrPeJnCJWXfjkevP~qmVeYt1bxgNIaHxEw61qvBjg__&Key-Pair-Id=K1P54FZWCHCL6J"
            />
          </div>
        </div>
        <div class="frame4"></div>
        <div class="sign-in-text1">
          <button class="nav-button"><a href="index.html">Home</a></button>
          <button class="nav-button"><a href="patientportal.html">Back</a></button>
        </div>
      </div>
    </header>
    <section class="container-frame1">
      <div class="image-background">
        <div class="oval-37"></div>
        <div class="container-113">
          <img
            class="image-5-icon"
            loading="lazy"
            alt=""
            src="https://d1xzdqg8s8ggsr.cloudfront.net/65f06e668a5b58e062cf65c5/8f0f9b36-43f6-484f-ba85-ae524ac0be99_1710256370339863100?Expires=-62135596800&Signature=d0sWhWz10GZMkRmbkrY61M~~WqoGMAdnS8bkCxbfbBlQ776xfkqTKE~Ev-7o9m~72l5n7MIH1JyyvMXIQr0YPlxiKubbW9U8Abuc~43H06Msn71JpRDw00O~Hvril4AXhGlNTpSf8yv7Z5cdwkSUHzSC4LsLEcJzekChYrmkMsiTexQdiEGgzfk4xcRkzKXK09y9tzuxRLgntE3qbUVjl6ba2GCCgbCzX1dHEyengXlua7qVczcu6BT4g4ITbP6ioFkJl4BsWf5yUHU-QUTJkMEgKBqRuL3g02ebberdqgynCgUrPeJnCJWXfjkevP~qmVeYt1bxgNIaHxEw61qvBjg__&Key-Pair-Id=K1P54FZWCHCL6J"
          />
          <div class="input-field">
            <img
              class="e-remove-2"
              loading="lazy"
              alt=""
              src="https://d1xzdqg8s8ggsr.cloudfront.net/65f06e668a5b58e062cf65c5/c0bec9b3-2e60-4dc2-b279-991e1aa8d2b0_1710256367169330556?Expires=-62135596800&Signature=mXRynD5C6VN~6qgOMcpVeKNRj4CFqrm3z-AiNgIbvv5XuT8qKuex~mR4B3sbS6lVB5o4Ki81EVjTh854YQCfPj7KC0ptJBhe1y~YLopyIM5DrxnREKXyi8gZgcwXCOlvekqqBwCdzV4upbeT~ANxEMNj-l~rblPgnoQu-l~5unTMvw2jDs61bvWpg1V2QER70mG6qLIjXAmqfQLESsbYRxJ-ZLvJtlpPL5PiYelkO8uRHQjoFPtZB75RaT4KCg-SjDseYfVIKFSJd81CDFF5AVCOLfvocz-oDq3QhVsxl1gspSnib2y73dxIxt4MSvKyF-O9FF71T8lzLWxavdJkkQ__&Key-Pair-Id=K1P54FZWCHCL6J"
            />
            <div class="dropdown-button">
              <div class="container-114">
                <form id="appointmentForm" method="post" action="/book-appointment" onsubmit="return validateForm()">
                  <div class="textbox-email">
                    <h1 class="book-an-appointment">Book an appointment</h1>
                    <div class="servicetextbox">
                      <div class="parent-textboxes">
                        <input
                          class="textbox-15"
                          placeholder="Name"
                          type="text"
                          id="name"
                          name="name"
                          pattern="[a-zA-Z\s]+"
                          title="Name should only contain letters."
                          style="color: black;"
                          required
                        />
                        <div id="nameError" class="error"></div>
                        <input
                          class="textbox-17"
                          placeholder="Email"
                          type="email"
                          id="email"
                          name="email"
                          required
                        />
                        <div id="emailError" class="error"></div>
                      </div>
                      <div class="parent-textboxes1">
                        <input
                          class="textbox-16"
                          placeholder="Phone"
                          type="tel"
                          id="phone"
                          name="phone"
                          pattern="[0-9]{10}"
                          title="Phone number should be 10 digits."
                          style="color: black;"
                          required
                        />
                        <div id="phoneError" class="error"></div>
                        <select id="department" name="department" onchange="populateDoctors()" class="textbox-18" required>
                          <option value="Department">Department</option>
                          <option value="Cardiology">Cardiology</option>
                          <option value="Dermatology">Dermatology</option>
                          <option value="Pediatrics">Pediatrics</option>
                          <option value="General Surgery">General Surgery</option>
                          <option value="Pulmonology">Pulmonology</option>
                          <option value="ENT">ENT</option>
                          <option value="Neurology">Neurology</option>
                          <option value="Gynecology">Gynecology</option>
                          <option value="Orthopedics">Orthopedics</option>
                          <option value="Physiotherapy">Physiotherapy</option>
                        </select>
                        <select id="doctor" name="doctor" class="textbox-18" required>
                          <option value="">Doctor</option>
                        </select>
                      </div>
                      <div class="parent-textboxes1">
                        <input
                          class="textbox-16"
                          type="date"
                          id="appointmentDate"
                          name="appointmentDate"
                          onchange="populateTimeSlots()"
                          required
                        />
                        <select class="textbox-18" id="appointmentTime" name="appointmentTime" required>
                          <option value="">Select Time Slot</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <br />
                  <input type="submit" value="Book Appointment" class="button-50" style="font-weight: bold;" />
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
  <script>
    function populateDoctors() {
      var department = document.getElementById("department").value;
      var doctorSelect = document.getElementById("doctor");
      doctorSelect.innerHTML = '<option value="">Select Doctor</option>';

      var xhr = new XMLHttpRequest();
      xhr.open("GET", "/doctors?department=" + department, true);
      xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            var doctors = JSON.parse(xhr.responseText);
            doctors.forEach(function (doctor) {
              var option = document.createElement("option");
              option.text = doctor.name;
              option.value = doctor.name;
              doctorSelect.add(option);
            });
          } else {
            console.error("Failed to fetch doctors.");
          }
        }
      };
      xhr.send();
    }

    function populateTimeSlots() {
      var appointmentDate = new Date(document.getElementById("appointmentDate").value);
      var today = new Date();
      var appointmentTimeSelect = document.getElementById("appointmentTime");
      appointmentTimeSelect.innerHTML = '<option value="">Select Time Slot</option>';

      if (appointmentDate < today) {
        alert("Please select a date from today onwards.");
        return;
      }

      var selectedDate = document.getElementById("appointmentDate").value;

      var xhr = new XMLHttpRequest();
      xhr.open("GET", "/get-booked-time-slots?date=" + selectedDate, true);
      xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            var bookedTimeSlots = JSON.parse(xhr.responseText);
            var availableTimeSlots = ["09:00 AM", "10:00 AM", "11:00 AM", "02:00 PM", "03:00 PM", "04:00 PM"];
            var filteredTimeSlots = availableTimeSlots.filter(function (slot) {
              return !bookedTimeSlots.includes(slot);
            });

            filteredTimeSlots.forEach(function (slot) {
              var option = document.createElement("option");
              option.text = slot;
              option.value = slot;
              appointmentTimeSelect.add(option);
            });
          } else {
            console.error("Failed to fetch booked time slots.");
          }
        }
      };
      xhr.send();
    }

    function validateForm() {
      var name = document.getElementById("name").value;
      var email = document.getElementById("email").value;
      var phone = document.getElementById("phone").value;

      var nameError = document.getElementById("nameError");
      var emailError = document.getElementById("emailError");
      var phoneError = document.getElementById("phoneError");

      var isValid = true;

      // Name validation
      if (!/^[a-zA-Z\s]+$/.test(name)) {
        nameError.textContent = "Name should only contain letters.";
        isValid = false;
      } else {
        nameError.textContent = "";
      }

      // Email validation
      if (!/^\S+@\S+\.\S+$/.test(email)) {
        emailError.textContent = "Please enter a valid email address.";
        isValid = false;
      } else {
        emailError.textContent = "";
      }

      // Phone validation
      if (!/^\d{10}$/.test(phone)) {
        phoneError.textContent = "Phone number should be 10 digits.";
        isValid = false;
      } else {
        phoneError.textContent = "";
      }

      return isValid;
    }
  </script>
</body>
</html>
